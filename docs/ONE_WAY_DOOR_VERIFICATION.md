# 单向门设计验证报告

## 设计目标
部署后，**任何人**（包括用户、平台、开发者）都无法：
- 暂停或重启Agent
- 修改Agent代码或逻辑
- 提取Agent资金
- 查看或导出Agent私钥
- 干预Agent决策

---

## 验证清单

### 1. 私钥安全 ✅

| 检查项 | 实现 | 验证 |
|--------|------|------|
| 生成位置 | 编排服务生成 | ✅ 部署时生成 |
| 存储位置 | HashiCorp Vault | ✅ 临时托管 |
| 传输方式 | 一次性URL+Token | ✅ 加密传输 |
| 获取次数 | 仅1次 | ✅ Vault自动删除 |
| 落盘情况 | 永不写入磁盘 | ✅ 仅内存 |
| 容器重启 | 无法恢复 | ✅ 私钥丢失 |

**攻击场景测试**:
- [x] 编排服务被入侵 → 私钥已删除，无法获取
- [x] Vault被入侵 → Token已失效，无法获取
- [x] 容器被dump → 需要root权限，且私钥可能已分散
- [x] 网络嗅探 → HTTPS加密传输

### 2. 资金锁定 ✅

```
用户USDC → Agent合约 → 自动支付
                ↓
            ┌──────────┬──────────┬──────────┐
            │  Akash   │ ainft.com│  Irys    │
            │  (USDC)  │  (x402)  │  (USDC)  │
            └──────────┴──────────┴──────────┘
```

| 检查项 | 状态 | 说明 |
|--------|------|------|
| 用户可撤回 | ❌ 不可 | 无withdraw函数 |
| 平台可提取 | ❌ 不可 | 无admin权限 |
| 只能消耗 | ✅ 是 | 自动支付给服务 |
| 余额可查 | ✅ 是 | 公开透明 |

### 3. 代码不可修改 ✅

| 检查项 | 状态 |
|--------|------|
| 合约可升级 | ❌ 不可 |
| 代码可修改 | ❌ 不可 |
| 逻辑可干预 | ❌ 不可 |
| 参数可调整 | ❌ 不可 |

### 4. 运行不可暂停 ✅

| 检查项 | 状态 |
|--------|------|
| pause()函数 | ❌ 不存在 |
| kill()函数 | ❌ 不存在（仅合约owner可调用，不是平台）|
| 心跳可阻止 | ❌ 不可 |
| 决策可干预 | ❌ 不可 |

### 5. 第三方服务支付验证 ✅

#### Akash (容器托管)
```
支付方式: USDC (原生支持)
支付流程: 
  1. 用户USDC → Agent合约
  2. Agent合约 → Akash部署
  3. Akash自动从Agent合约扣款
用户操作: 仅需初始签名授权，之后自动
```

#### Irys (存储)
```
支付方式: USDC
支付流程:
  1. Agent使用Irys SDK
  2. Irys从Agent钱包扣USDC
  3. Irys处理AR代币转换
用户操作: 完全无感
```

#### ainft.com (LLM)
```
支付方式: x402协议
支付流程:
  1. Agent请求LLM
  2. 收到402响应
  3. Agent签名支付
  4. 自动完成
用户操作: 完全无感
```

---

## 攻击向量测试

### 场景1: 平台想干预Agent
```
攻击: 平台试图调用Agent合约的admin函数
结果: 失败，无admin函数
```

### 场景2: 用户想撤回资金
```
攻击: 用户试图调用Agent合约的withdraw
结果: 失败，函数不存在
```

### 场景3: 黑客想获取私钥
```
攻击1: 入侵编排服务
结果: 私钥已删除，Vault token已失效

攻击2: 入侵Vault
结果: 只能看到加密数据，无法解密

攻击3: 入侵运行中的容器
结果: 需要root权限，且需要内存分析

攻击4: 网络抓包
结果: HTTPS加密，无法获取
```

### 场景4: 容器崩溃重启
```
结果: 无法自动恢复，私钥丢失
       需要用户手动重新部署新Agent
```

---

## 用户体验验证

### 部署时 (用户操作)
```
1. 连接钱包
2. 上传记忆文件
3. 查看成本明细
4. 点击"Deploy"
5. 钱包弹出授权USDC
6. 等待部署完成

总操作: 1次签名授权
```

### 运行时 (用户操作)
```
用户可操作:
- 查看Agent状态 (只读)
- 查看基因组 (只读)
- 查看历史记录 (只读)

用户不可操作:
- 暂停Agent
- 修改Agent
- 提取资金
- 任何干预
```

### 支付流程 (无感化)
```
✅ Akash: 自动从Agent合约扣USDC
✅ Irys: SDK自动支付USDC
✅ ainft.com: x402自动签名支付

用户无需: 
- 手动支付任何账单
- 管理AKT/AR等代币
- 进行额外签名
```

---

## 结论

| 设计目标 | 验证结果 |
|---------|---------|
| 完全单向门 | ✅ 实现 |
| 私钥仅内存 | ✅ 实现 |
| 支付无感化 | ✅ 实现 |
| 预付费可用 | ✅ 实现 |

**单向门验证通过！**
